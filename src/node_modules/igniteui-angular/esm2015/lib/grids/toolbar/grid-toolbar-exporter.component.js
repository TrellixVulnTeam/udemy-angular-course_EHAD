import { Component, ContentChild, Input, Output, EventEmitter, Optional, Host } from '@angular/core';
import { first } from 'rxjs/operators';
import { BaseToolbarDirective } from './grid-toolbar.base';
import { IgxGridToolbarComponent } from './grid-toolbar.component';
import { IgxExcelTextDirective, IgxCSVTextDirective } from './common';
import { CsvFileTypes, IgxCsvExporterOptions, IgxCsvExporterService, IgxExcelExporterOptions, IgxExcelExporterService } from '../../services/public_api';
/**
 * Provides a pre-configured exporter component for the grid.
 *
 * @remarks
 * This component still needs the actual exporter service(s) provided in the DI chain
 * in order to export something.
 *
 * @igxModule IgxGridToolbarModule
 * @igxParent IgxGridToolbarComponent
 *
 */
export class IgxGridToolbarExporterComponent extends BaseToolbarDirective {
    constructor(toolbar, excelExporter, csvExporter) {
        super(toolbar);
        this.toolbar = toolbar;
        this.excelExporter = excelExporter;
        this.csvExporter = csvExporter;
        /**
         * Show entry for CSV export.
         */
        this.exportCSV = true;
        /**
         * Show entry for Excel export.
         */
        this.exportExcel = true;
        /**
         * The name for the exported file.
         */
        this.filename = 'ExportedData';
        /**
         * Emitted when starting an export operation. Re-emitted additionally
         * by the grid itself.
         */
        this.exportStarted = new EventEmitter();
        /**
         * Emitted on successful ending of an export operation.
         */
        this.exportEnded = new EventEmitter();
        /**
         * Indicates whether there is an export in progress.
         */
        this.isExporting = false;
    }
    /**
     * Returns whether the CSV exporter service is available in the DI chain.
     */
    get hasCsvExporter() {
        return !!this.csvExporter;
    }
    /**
     * Returns whether the Excel exporter service is available in the DI chain.
     */
    get hasExcelExporter() {
        return !!this.excelExporter;
    }
    export(type, toggleRef) {
        let options;
        let exporter;
        toggleRef === null || toggleRef === void 0 ? void 0 : toggleRef.close();
        switch (type) {
            case 'csv':
                options = new IgxCsvExporterOptions(this.filename, CsvFileTypes.CSV);
                exporter = this.csvExporter;
                break;
            case 'excel':
                options = new IgxExcelExporterOptions(this.filename);
                exporter = this.excelExporter;
        }
        const args = { exporter, options, grid: this.grid, cancel: false };
        this.exportStarted.emit(args);
        this.grid.toolbarExporting.emit(args);
        this.isExporting = true;
        this.toolbar.showProgress = true;
        if (args.cancel) {
            return;
        }
        exporter.exportEnded.pipe(first()).subscribe(() => {
            this.exportEnded.emit();
            this.isExporting = false;
            this.toolbar.showProgress = false;
        });
        exporter.export(this.grid, options);
    }
}
IgxGridToolbarExporterComponent.decorators = [
    { type: Component, args: [{
                selector: 'igx-grid-toolbar-exporter',
                template: "<div class=\"igx-grid-toolbar__dropdown\" id=\"btnExport\">\n    <button [title]=\"grid?.resourceStrings.igx_grid_toolbar_exporter_button_tooltip\" [disabled]=\"isExporting\"\n        igxButton=\"outlined\" [displayDensity]=\"grid.displayDensity\" igxRipple #btn (click)=\"toggle(btn, toggleRef)\">\n        <igx-icon>import_export</igx-icon>\n        <span #ref>\n            <ng-content></ng-content>\n        </span>\n        <span *ngIf=\"!ref.childNodes.length\">\n            {{ grid.exportText || grid?.resourceStrings.igx_grid_toolbar_exporter_button_label }}\n        </span>\n        <igx-icon>arrow_drop_down</igx-icon>\n    </button>\n\n    <ul class=\"igx-grid-toolbar__dd-list\" igxToggle #toggleRef=\"toggle\">\n        <li *ngIf=\"grid.exportExcel || exportExcel\" #btnExportExcel id=\"btnExportExcel\"\n            class=\"igx-grid-toolbar__dd-list-items\" igxRipple (click)=\"export('excel', toggleRef)\">\n            <ng-template #excel>\n                <ng-content select=[excelText],excel-text></ng-content>\n            </ng-template>\n            <excel-text *ngIf=\"!hasExcelAttr\">\n                {{ grid.exportExcelText || grid?.resourceStrings.igx_grid_toolbar_exporter_excel_entry_text}}\n            </excel-text>\n            <ng-container *ngTemplateOutlet=\"excel\"></ng-container>\n        </li>\n\n        <li *ngIf=\"grid.exportCsv || exportCSV\" #btnExportCsv id=\"btnExportCsv\" class=\"igx-grid-toolbar__dd-list-items\"\n            igxRipple (click)=\"export('csv', toggleRef)\">\n            <ng-template #csv>\n                <ng-content select=[csvText],csv-text></ng-content>\n            </ng-template>\n            <csv-text *ngIf=\"!hasCSVAttr\">\n                {{ grid.exportCsvText || grid?.resourceStrings.igx_grid_toolbar_exporter_csv_entry_text }}</csv-text>\n            <ng-container *ngTemplateOutlet=\"csv\"></ng-container>\n        </li>\n    </ul>\n</div>\n"
            },] }
];
IgxGridToolbarExporterComponent.ctorParameters = () => [
    { type: IgxGridToolbarComponent, decorators: [{ type: Host }] },
    { type: IgxExcelExporterService, decorators: [{ type: Optional }] },
    { type: IgxCsvExporterService, decorators: [{ type: Optional }] }
];
IgxGridToolbarExporterComponent.propDecorators = {
    hasExcelAttr: [{ type: ContentChild, args: [IgxExcelTextDirective,] }],
    hasCSVAttr: [{ type: ContentChild, args: [IgxCSVTextDirective,] }],
    exportCSV: [{ type: Input }],
    exportExcel: [{ type: Input }],
    filename: [{ type: Input }],
    exportStarted: [{ type: Output }],
    exportEnded: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC10b29sYmFyLWV4cG9ydGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lnbml0ZXVpLWFuZ3VsYXIvc3JjL2xpYi9ncmlkcy90b29sYmFyL2dyaWQtdG9vbGJhci1leHBvcnRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDM0QsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDbkUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLG1CQUFtQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ3RFLE9BQU8sRUFDSCxZQUFZLEVBRVoscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQix1QkFBdUIsRUFDdkIsdUJBQXVCLEVBQzFCLE1BQU0sMkJBQTJCLENBQUM7QUFlbkM7Ozs7Ozs7Ozs7R0FVRztBQUtILE1BQU0sT0FBTywrQkFBZ0MsU0FBUSxvQkFBb0I7SUFrRXJFLFlBQ3NCLE9BQWdDLEVBQzlCLGFBQXNDLEVBQ3RDLFdBQWtDO1FBRXRELEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUpHLFlBQU8sR0FBUCxPQUFPLENBQXlCO1FBQzlCLGtCQUFhLEdBQWIsYUFBYSxDQUF5QjtRQUN0QyxnQkFBVyxHQUFYLFdBQVcsQ0FBdUI7UUF2QzFEOztXQUVHO1FBRUksY0FBUyxHQUFHLElBQUksQ0FBQztRQUV4Qjs7V0FFRztRQUVJLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBRTFCOztXQUVHO1FBRUksYUFBUSxHQUFHLGNBQWMsQ0FBQztRQUVqQzs7O1dBR0c7UUFFSSxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFvQixDQUFDO1FBRTVEOztXQUVHO1FBRUksZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBRTlDOztXQUVHO1FBQ0ksZ0JBQVcsR0FBRyxLQUFLLENBQUM7SUFRM0IsQ0FBQztJQXhERDs7T0FFRztJQUNILElBQVcsY0FBYztRQUNyQixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzlCLENBQUM7SUFFRDs7T0FFRztJQUNILElBQVcsZ0JBQWdCO1FBQ3ZCLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUM7SUFDaEMsQ0FBQztJQThDTSxNQUFNLENBQUMsSUFBcUIsRUFBRSxTQUE4QjtRQUMvRCxJQUFJLE9BQTJCLENBQUM7UUFDaEMsSUFBSSxRQUF5QixDQUFDO1FBRTlCLFNBQVMsYUFBVCxTQUFTLHVCQUFULFNBQVMsQ0FBRSxLQUFLLEVBQUUsQ0FBQztRQUVuQixRQUFRLElBQUksRUFBRTtZQUNWLEtBQUssS0FBSztnQkFDTixPQUFPLEdBQUcsSUFBSSxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDckUsUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQzVCLE1BQU07WUFDVixLQUFLLE9BQU87Z0JBQ1IsT0FBTyxHQUFHLElBQUksdUJBQXVCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUNyRCxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztTQUNyQztRQUVELE1BQU0sSUFBSSxHQUFHLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFzQixDQUFDO1FBRXZGLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztRQUVqQyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDYixPQUFPO1NBQ1Y7UUFFRCxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDOUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztZQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7UUFDdEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDeEMsQ0FBQzs7O1lBaEhKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsMkJBQTJCO2dCQUNyQyw2NERBQXFEO2FBQ3hEOzs7WUF0Q1EsdUJBQXVCLHVCQTBHdkIsSUFBSTtZQWxHVCx1QkFBdUIsdUJBbUdsQixRQUFRO1lBckdiLHFCQUFxQix1QkFzR2hCLFFBQVE7OzsyQkEvRFosWUFBWSxTQUFDLHFCQUFxQjt5QkFPbEMsWUFBWSxTQUFDLG1CQUFtQjt3QkFvQmhDLEtBQUs7MEJBTUwsS0FBSzt1QkFNTCxLQUFLOzRCQU9MLE1BQU07MEJBTU4sTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIE9wdGlvbmFsLCBIb3N0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBmaXJzdCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEJhc2VUb29sYmFyRGlyZWN0aXZlIH0gZnJvbSAnLi9ncmlkLXRvb2xiYXIuYmFzZSc7XG5pbXBvcnQgeyBJZ3hHcmlkVG9vbGJhckNvbXBvbmVudCB9IGZyb20gJy4vZ3JpZC10b29sYmFyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJZ3hFeGNlbFRleHREaXJlY3RpdmUsIElneENTVlRleHREaXJlY3RpdmUgfSBmcm9tICcuL2NvbW1vbic7XG5pbXBvcnQge1xuICAgIENzdkZpbGVUeXBlcyxcbiAgICBJZ3hCYXNlRXhwb3J0ZXIsXG4gICAgSWd4Q3N2RXhwb3J0ZXJPcHRpb25zLFxuICAgIElneENzdkV4cG9ydGVyU2VydmljZSxcbiAgICBJZ3hFeGNlbEV4cG9ydGVyT3B0aW9ucyxcbiAgICBJZ3hFeGNlbEV4cG9ydGVyU2VydmljZVxufSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wdWJsaWNfYXBpJztcbmltcG9ydCB7IElneEdyaWRCYXNlRGlyZWN0aXZlIH0gZnJvbSAnLi4vZ3JpZC1iYXNlLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBJZ3hUb2dnbGVEaXJlY3RpdmUgfSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL3RvZ2dsZS90b2dnbGUuZGlyZWN0aXZlJztcblxuXG5leHBvcnQgdHlwZSBJZ3hFeHBvcnRlck9wdGlvbnMgPSBJZ3hDc3ZFeHBvcnRlck9wdGlvbnMgfCBJZ3hFeGNlbEV4cG9ydGVyT3B0aW9ucztcblxuXG5leHBvcnQgaW50ZXJmYWNlIElneEV4cG9ydGVyRXZlbnQge1xuICAgIGV4cG9ydGVyOiBJZ3hCYXNlRXhwb3J0ZXI7XG4gICAgb3B0aW9uczogSWd4RXhwb3J0ZXJPcHRpb25zO1xuICAgIGdyaWQ6IElneEdyaWRCYXNlRGlyZWN0aXZlO1xuICAgIGNhbmNlbDogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhIHByZS1jb25maWd1cmVkIGV4cG9ydGVyIGNvbXBvbmVudCBmb3IgdGhlIGdyaWQuXG4gKlxuICogQHJlbWFya3NcbiAqIFRoaXMgY29tcG9uZW50IHN0aWxsIG5lZWRzIHRoZSBhY3R1YWwgZXhwb3J0ZXIgc2VydmljZShzKSBwcm92aWRlZCBpbiB0aGUgREkgY2hhaW5cbiAqIGluIG9yZGVyIHRvIGV4cG9ydCBzb21ldGhpbmcuXG4gKlxuICogQGlneE1vZHVsZSBJZ3hHcmlkVG9vbGJhck1vZHVsZVxuICogQGlneFBhcmVudCBJZ3hHcmlkVG9vbGJhckNvbXBvbmVudFxuICpcbiAqL1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdpZ3gtZ3JpZC10b29sYmFyLWV4cG9ydGVyJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZ3JpZC10b29sYmFyLWV4cG9ydGVyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBJZ3hHcmlkVG9vbGJhckV4cG9ydGVyQ29tcG9uZW50IGV4dGVuZHMgQmFzZVRvb2xiYXJEaXJlY3RpdmUge1xuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIEBDb250ZW50Q2hpbGQoSWd4RXhjZWxUZXh0RGlyZWN0aXZlKVxuICAgIHB1YmxpYyBoYXNFeGNlbEF0dHI6IElneEV4Y2VsVGV4dERpcmVjdGl2ZTtcblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBAQ29udGVudENoaWxkKElneENTVlRleHREaXJlY3RpdmUpXG4gICAgcHVibGljIGhhc0NTVkF0dHI6IElneENTVlRleHREaXJlY3RpdmU7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIENTViBleHBvcnRlciBzZXJ2aWNlIGlzIGF2YWlsYWJsZSBpbiB0aGUgREkgY2hhaW4uXG4gICAgICovXG4gICAgcHVibGljIGdldCBoYXNDc3ZFeHBvcnRlcigpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5jc3ZFeHBvcnRlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIEV4Y2VsIGV4cG9ydGVyIHNlcnZpY2UgaXMgYXZhaWxhYmxlIGluIHRoZSBESSBjaGFpbi5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0IGhhc0V4Y2VsRXhwb3J0ZXIoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuZXhjZWxFeHBvcnRlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IGVudHJ5IGZvciBDU1YgZXhwb3J0LlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGV4cG9ydENTViA9IHRydWU7XG5cbiAgICAvKipcbiAgICAgKiBTaG93IGVudHJ5IGZvciBFeGNlbCBleHBvcnQuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgZXhwb3J0RXhjZWwgPSB0cnVlO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG5hbWUgZm9yIHRoZSBleHBvcnRlZCBmaWxlLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGZpbGVuYW1lID0gJ0V4cG9ydGVkRGF0YSc7XG5cbiAgICAvKipcbiAgICAgKiBFbWl0dGVkIHdoZW4gc3RhcnRpbmcgYW4gZXhwb3J0IG9wZXJhdGlvbi4gUmUtZW1pdHRlZCBhZGRpdGlvbmFsbHlcbiAgICAgKiBieSB0aGUgZ3JpZCBpdHNlbGYuXG4gICAgICovXG4gICAgQE91dHB1dCgpXG4gICAgcHVibGljIGV4cG9ydFN0YXJ0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPElneEV4cG9ydGVyRXZlbnQ+KCk7XG5cbiAgICAvKipcbiAgICAgKiBFbWl0dGVkIG9uIHN1Y2Nlc3NmdWwgZW5kaW5nIG9mIGFuIGV4cG9ydCBvcGVyYXRpb24uXG4gICAgICovXG4gICAgQE91dHB1dCgpXG4gICAgcHVibGljIGV4cG9ydEVuZGVkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gICAgLyoqXG4gICAgICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlcmUgaXMgYW4gZXhwb3J0IGluIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBpc0V4cG9ydGluZyA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIEBIb3N0KCkgcHJvdGVjdGVkIHRvb2xiYXI6IElneEdyaWRUb29sYmFyQ29tcG9uZW50LFxuICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGV4Y2VsRXhwb3J0ZXI6IElneEV4Y2VsRXhwb3J0ZXJTZXJ2aWNlLFxuICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNzdkV4cG9ydGVyOiBJZ3hDc3ZFeHBvcnRlclNlcnZpY2UsXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHRvb2xiYXIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBleHBvcnQodHlwZTogJ2V4Y2VsJyB8ICdjc3YnLCB0b2dnbGVSZWY/OiBJZ3hUb2dnbGVEaXJlY3RpdmUpOiB2b2lkIHtcbiAgICAgICAgbGV0IG9wdGlvbnM6IElneEV4cG9ydGVyT3B0aW9ucztcbiAgICAgICAgbGV0IGV4cG9ydGVyOiBJZ3hCYXNlRXhwb3J0ZXI7XG5cbiAgICAgICAgdG9nZ2xlUmVmPy5jbG9zZSgpO1xuXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnY3N2JzpcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gbmV3IElneENzdkV4cG9ydGVyT3B0aW9ucyh0aGlzLmZpbGVuYW1lLCBDc3ZGaWxlVHlwZXMuQ1NWKTtcbiAgICAgICAgICAgICAgICBleHBvcnRlciA9IHRoaXMuY3N2RXhwb3J0ZXI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdleGNlbCc6XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG5ldyBJZ3hFeGNlbEV4cG9ydGVyT3B0aW9ucyh0aGlzLmZpbGVuYW1lKTtcbiAgICAgICAgICAgICAgICBleHBvcnRlciA9IHRoaXMuZXhjZWxFeHBvcnRlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFyZ3MgPSB7IGV4cG9ydGVyLCBvcHRpb25zLCBncmlkOiB0aGlzLmdyaWQsIGNhbmNlbDogZmFsc2UgfSBhcyBJZ3hFeHBvcnRlckV2ZW50O1xuXG4gICAgICAgIHRoaXMuZXhwb3J0U3RhcnRlZC5lbWl0KGFyZ3MpO1xuICAgICAgICB0aGlzLmdyaWQudG9vbGJhckV4cG9ydGluZy5lbWl0KGFyZ3MpO1xuICAgICAgICB0aGlzLmlzRXhwb3J0aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy50b29sYmFyLnNob3dQcm9ncmVzcyA9IHRydWU7XG5cbiAgICAgICAgaWYgKGFyZ3MuY2FuY2VsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBleHBvcnRlci5leHBvcnRFbmRlZC5waXBlKGZpcnN0KCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmV4cG9ydEVuZGVkLmVtaXQoKTtcbiAgICAgICAgICAgIHRoaXMuaXNFeHBvcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudG9vbGJhci5zaG93UHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZXhwb3J0ZXIuZXhwb3J0KHRoaXMuZ3JpZCwgb3B0aW9ucyk7XG4gICAgfVxufVxuIl19